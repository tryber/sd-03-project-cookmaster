<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cookmaster - Cadastrar nova receita</title>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js" integrity="sha384-LtrjvnR4Twt/qOuYxE721u19sVFLVSA4hf/rRt6PrZTmiPltdZcI7q7PXQBYTKyf" crossorigin="anonymous"></script>

  </head>
  <body>
    <%- include('../header', {user})%>

    <div class="container">
      <h1>Nova Receita</h1>
      <form method="POST" id="recipe-form" action="/recipes" class="form">
        <div class="form-group">
          <label for="recipe-name">Nome da Receita
            <input type="text" name="recipeName" id="recipe-name" class="form-control" data-testid="nome-receita">
          </label>
        </div>
        <div class="form-group">
          <h4>Ingredientes</h4>
          <ul class="list-group list-group-flush" id="ingredients-list"></ul>
          <input type="hidden" id="hidden-input" name="ingredients">
          <label for="ingredients">Nome do Ingrediente
            <input type="text" id="ingredients" class="form-control" data-testid="ingredientes">
          </label>
          <button class="btn btn-warning" type="button" data-testid="adicionar-ingrediente" onClick="newIngredient()">
            Adicionar Ingrediente
          </button>
        </div>
        <div class="form-group">
          <label for="instructions">Modo de Preparo
            <input type="text" class="form-control" name="instructions" id="instructions" data-testid="modo-de-preparo">
          </label>
        </div>

        <button type="submit" class="btn btn-primary" data-testid="postar-receita">
          Salvar Receita
        </button>
      </form>
    </div>

    <script>
      function deleteButton() {
        const delBtn = document.createElement('button');
        delBtn.innerText = 'Excluir Ingrediente';
        delBtn.classList.add('btn');
        delBtn.classList.add('btn-danger');
        delBtn.addEventListener('click', (event) => {
          const item = event.target.parentNode;
          const list = item.parentNode;
          list.removeChild(item);
        });
        return delBtn;
      }
      function newIngredient() {
        const ingredientInput = document.getElementById('ingredients');
        const item = document.createElement('li');
        item.innerText = ingredientInput.value;
        item.classList.add('list-group-item');
        const delBtn = deleteButton();
        item.appendChild(delBtn);
        const list = document.getElementById('ingredients-list');
        list.appendChild(item);
        ingredientInput.value = '';
      }
      window.onload = () => {
        const form = document.getElementById('recipe-form');
        form.addEventListener('submit', (event) => {
          event.preventDefault();
          const list = document.getElementById('ingredients-list').children;
          const ings = [];
          for (let i = 0; i < list.length; i += 1) {
            ings.push(list[i].innerText.slice(0, -19));
          }
          const hiddenInput = document.getElementById('hidden-input');
          hiddenInput.value = ings.join(',');
          hiddenInput.type = 'text';
          const form = document.getElementById('recipe-form');
          form.submit();
        });
      }
    </script>
  </body>
</html>
